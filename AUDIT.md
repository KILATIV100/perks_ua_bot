# –¢–µ—Ö–Ω—ñ—á–Ω–∏–π –∞—É–¥–∏—Ç PerkUp ‚Äî –ó–≤—ñ—Ç

**–î–∞—Ç–∞:** 2026-02-16
**–í–µ—Ä—Å—ñ—è:** v2.0 (Modular Monolith)
**–°—Ç–µ–∫:** Node.js (Fastify), PostgreSQL (Prisma), React (Vite), Socket.IO, grammY

---

## 1. –ö–†–ò–¢–ò–ß–ù–Ü –ü–û–ú–ò–õ–ö–ò

### 1.1 `devMode` –¥–æ–∑–≤–æ–ª—è—î –±—É–¥—å-–∫–æ–º—É –æ–±—ñ–π—Ç–∏ –≥–µ–æ–ø–µ—Ä–µ–≤—ñ—Ä–∫—É (CRITICAL)

**–§–∞–π–ª:** `server/src/modules/loyalty/loyalty.service.ts:163`

```typescript
const bypassGeo = DEV_TELEGRAM_IDS.has(telegramId) || input.devMode === true;
```

–ü–æ–ª–µ `devMode` –ø—Ä–∏–π–º–∞—î—Ç—å—Å—è –Ω–∞–ø—Ä—è–º—É –∑ —Ç—ñ–ª–∞ –∑–∞–ø–∏—Ç—É (`loyalty.routes.ts:87`). –ë—É–¥—å-—è–∫–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–æ–∂–µ –Ω–∞–¥—ñ—Å–ª–∞—Ç–∏ `{ devMode: true }` –≤ POST-–∑–∞–ø–∏—Ç—ñ –Ω–∞ `/api/loyalty/spin` —ñ –∫—Ä—É—Ç–∏—Ç–∏ –∫–æ–ª–µ—Å–æ –∑ –±—É–¥—å-—è–∫–æ—ó —Ç–æ—á–∫–∏ —Å–≤—ñ—Ç—É –±–µ–∑ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç. –¢–µ —Å–∞–º–µ —Å—Ç–æ—Å—É—î—Ç—å—Å—è legacy-–µ–Ω–¥–ø–æ—ñ–Ω—Ç—É `/api/user/spin` (`routes/users.ts:255`).

**–†–∏–∑–∏–∫:** –ü–æ–≤–Ω–µ –æ–±—Ö–æ–¥–∂–µ–Ω–Ω—è –≥–µ–æ–ª–æ–∫–∞—Ü—ñ–π–Ω–æ—ó –ª–æ–≥—ñ–∫–∏. –ú–æ–∂–ª–∏–≤—ñ—Å—Ç—å –º–∞—Å–æ–≤–æ—ó "–Ω–∞–∫—Ä—É—Ç–∫–∏" –±–∞–ª—ñ–≤.

**–†—ñ—à–µ–Ω–Ω—è:** –í–∏–¥–∞–ª–∏—Ç–∏ `devMode` –∑ –ø—É–±–ª—ñ—á–Ω–æ–≥–æ API. –û–±–º–µ–∂–∏—Ç–∏ bypass –ª–∏—à–µ `DEV_TELEGRAM_IDS` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–Ω—ñ–π —Å—Ç–æ—Ä–æ–Ω—ñ. –ù—ñ–∫–æ–ª–∏ –Ω–µ –¥–æ–≤—ñ—Ä—è—Ç–∏ –∫–ª—ñ—î–Ω—Ç—Å—å–∫–æ–º—É `devMode`.

---

### 1.2 –ù–µ–≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ—Å—Ç—å —Ñ–æ—Ä–º–∞—Ç—É referral-–ø–æ—Å–∏–ª–∞–Ω—å (CRITICAL)

–Ü—Å–Ω—É—é—Ç—å **–¥–≤–∞ —Ä—ñ–∑–Ω–∏—Ö —Ñ–æ—Ä–º–∞—Ç–∏** —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∏—Ö –ø–æ—Å–∏–ª–∞–Ω—å, —è–∫—ñ –≥–µ–Ω–µ—Ä—É—é—Ç—å—Å—è —Ä—ñ–∑–Ω–∏–º–∏ —á–∞—Å—Ç–∏–Ω–∞–º–∏ —Å–∏—Å—Ç–µ–º–∏:

| –î–∂–µ—Ä–µ–ª–æ | –§–æ—Ä–º–∞—Ç | ID-—Ç–∏–ø |
|---------|--------|--------|
| –ë–æ—Ç (–∫–ª–∞–≤—ñ–∞—Ç—É—Ä–∞) `bot/src/index.ts:635` | `ref_<telegramId>` | Telegram ID (—á–∏—Å–ª–æ–≤–∏–π) |
| API `/api/referral/link` `referral.routes.ts:44` | `ref_<user.id>` | Prisma CUID (–±—É–∫–≤–µ–Ω–Ω–æ-—Ü–∏—Ñ—Ä–æ–≤–∏–π) |

–¶–µ –ø—Ä–∏–∑–≤–æ–¥–∏—Ç—å –¥–æ –∫–∞—Å–∫–∞–¥–Ω–∏—Ö –ø–æ–º–∏–ª–æ–∫:

- **v2 auth** (`auth.routes.ts:92`): `extractReferrerId` –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î regex `/^ref_?(\d+)$/` ‚Äî **—Ç—ñ–ª—å–∫–∏ —Ü–∏—Ñ—Ä–∏**. –ü–æ—Å–∏–ª–∞–Ω–Ω—è –∑ CUID (–∑ API) –Ω—ñ–∫–æ–ª–∏ –Ω–µ —Å–ø—Ä–∞—Ü—é—é—Ç—å.
- **Legacy sync** (`routes/users.ts:169`): –∑–±–µ—Ä—ñ–≥–∞—î `body.referrerId` (telegramId) —É –ø–æ–ª–µ `referredById`, —è–∫–µ —î FK –Ω–∞ `User.id` (CUID). –¶–µ –ø–æ—Ä—É—à—É—î FK-constraint —ñ –ø—Ä–∏–∑–≤–µ–¥–µ –¥–æ –ø–æ–º–∏–ª–∫–∏ Prisma.

**–†–∏–∑–∏–∫:** –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–∞—Ü—é—î –ª–∏—à–µ —á–∞—Å—Ç–∫–æ–≤–æ. –ó–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ —Ç–æ–≥–æ, —è–∫–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è —ñ —è–∫–∏–π endpoint –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è, —Ä–µ—Ñ–µ—Ä–∞–ª –∞–±–æ –Ω–µ –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è, –∞–±–æ –≤–∏–∫–ª–∏–∫–∞—î –ø–æ–º–∏–ª–∫—É –ë–î.

**–†—ñ—à–µ–Ω–Ω—è:** –£–Ω—ñ—Ñ—ñ–∫—É–≤–∞—Ç–∏ —Ñ–æ—Ä–º–∞—Ç ‚Äî –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –∞–±–æ `telegramId`, –∞–±–æ –≤–Ω—É—Ç—Ä—ñ—à–Ω—ñ–π `id` —É –≤—Å—ñ—Ö –º—ñ—Å—Ü—è—Ö. –†–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è `telegramId`, –æ—Å–∫—ñ–ª—å–∫–∏ –π–æ–≥–æ –ª–µ–≥–∫–æ –æ—Ç—Ä–∏–º–∞—Ç–∏ –≤ Telegram-–±–æ—Ç—ñ.

---

### 1.3 Legacy-–∫–æ–¥–∏ –Ω–µ—Å—É–º—ñ—Å–Ω—ñ –∑ –∞–¥–º—ñ–Ω-–≤–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—î—é (CRITICAL)

**Legacy redeem** (`routes/users.ts:451-455`) –≥–µ–Ω–µ—Ä—É—î –∫–æ–¥–∏ —É —Ñ–æ—Ä–º–∞—Ç—ñ `XX-00000` (–ª—ñ—Ç–µ—Ä–∏ + 5 —Ü–∏—Ñ—Ä), –Ω–∞–ø—Ä–∏–∫–ª–∞–¥ `CO-77341`.

**Admin verify-code** (`admin.routes.ts:33`) –≤–∞–ª—ñ–¥—É—î –∫–æ–¥–∏ regex-–æ–º `^\d{4}$` ‚Äî —Ç—ñ–ª—å–∫–∏ 4 —Ü–∏—Ñ—Ä–∏.

Legacy-–∫–æ–¥–∏ **–Ω—ñ–∫–æ–ª–∏ –Ω–µ –ø—Ä–æ–π–¥—É—Ç—å** –∞–¥–º—ñ–Ω-–≤–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—é. –Ø–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –æ–±–º—ñ–Ω—è–≤ –±–∞–ª–∏ —á–µ—Ä–µ–∑ legacy-endpoint, –±–∞—Ä–∏—Å—Ç–∞ –Ω–µ –∑–º–æ–∂–µ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ –∫–æ–¥.

**–†—ñ—à–µ–Ω–Ω—è:** –í–∏–¥–∞–ª–∏—Ç–∏ legacy redeem –∞–±–æ –ø—Ä–∏–≤–µ—Å—Ç–∏ —Ñ–æ—Ä–º–∞—Ç –∫–æ–¥—ñ–≤ –¥–æ —î–¥–∏–Ω–æ–≥–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—É (4 —Ü–∏—Ñ—Ä–∏).

---

### 1.4 –í–∞–ª—ñ–¥–∞—Ü—ñ—è gameId —è–∫ UUID, –∞–ª–µ schema –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î CUID (HIGH)

**–§–∞–π–ª:** `server/src/modules/games/games.routes.ts:43-44, 48`

```typescript
const joinGameSchema = z.object({
  gameId: z.string().uuid(),  // –í–∞–ª—ñ–¥—É—î UUID
});
```

–ê–ª–µ `GameSession.id` —É schema.prisma –º–∞—î `@id @default(cuid())`. CUID (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `cm5abc123xyz`) ‚Äî **–Ω–µ UUID**. –í–∞–ª—ñ–¥–∞—Ü—ñ—è `z.string().uuid()` –≤—ñ–¥—Ö–∏–ª–∏—Ç—å –±—É–¥—å-—è–∫–∏–π —Ä–µ–∞–ª—å–Ω–∏–π game ID.

**–í–ø–ª–∏–≤:** –ù–µ–º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –ø—Ä–∏—î–¥–Ω–∞—Ç–∏—Å—è –¥–æ –æ–Ω–ª–∞–π–Ω-–≥—Ä–∏ (`/api/games/join`) —Ç–∞ –∑—Ä–æ–±–∏—Ç–∏ AI-—Ö—ñ–¥ (`/api/games/ai-move`).

**–†—ñ—à–µ–Ω–Ω—è:** –ó–∞–º—ñ–Ω–∏—Ç–∏ `z.string().uuid()` –Ω–∞ `z.string().min(1)` –∞–±–æ `z.string().cuid()`.

---

### 1.5 –ü–æ–¥–≤—ñ–π–Ω–µ –Ω–∞—Ä–∞—Ö—É–≤–∞–Ω–Ω—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–≥–æ –±–æ–Ω—É—Å—É (HIGH)

–Ü—Å–Ω—É—î —Ä–∏–∑–∏–∫ –ø–æ–¥–≤—ñ–π–Ω–æ–≥–æ –Ω–∞—Ä–∞—Ö—É–≤–∞–Ω–Ω—è +10 –±–∞–ª—ñ–≤ —Ä–µ—Ñ–µ—Ä–µ—Ä—É –ø—Ä–∏ –∑–º—ñ—à—É–≤–∞–Ω–Ω—ñ legacy —Ç–∞ v2 endpoints:

1. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –∫—Ä—É—Ç–∏—Ç—å –∫–æ–ª–µ—Å–æ —á–µ—Ä–µ–∑ legacy `/api/user/spin` ‚Äî –ø–µ—Ä–µ–≤—ñ—Ä—è—î—Ç—å—Å—è `user.totalSpins === 0`, –±–æ–Ω—É—Å –Ω–∞—Ä–∞—Ö–æ–≤—É—î—Ç—å—Å—è, **–∞–ª–µ `referralBonusPaid` –ù–ï –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î—Ç—å—Å—è –≤ `true`**.
2. –ù–∞—Å—Ç—É–ø–Ω–æ–≥–æ –¥–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –∫—Ä—É—Ç–∏—Ç—å —á–µ—Ä–µ–∑ v2 `/api/loyalty/spin` ‚Äî –ø–µ—Ä–µ–≤—ñ—Ä—è—î—Ç—å—Å—è `!user.referralBonusPaid` (–≤—Å–µ —â–µ `false`) ‚Üí –±–æ–Ω—É—Å –Ω–∞—Ä–∞—Ö–æ–≤—É—î—Ç—å—Å—è **–ø–æ–≤—Ç–æ—Ä–Ω–æ**.

**–†—ñ—à–µ–Ω–Ω—è:** –î–æ–¥–∞—Ç–∏ `referralBonusPaid: true` –≤ legacy spin route –ø—ñ—Å–ª—è –Ω–∞—Ä–∞—Ö—É–≤–∞–Ω–Ω—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–≥–æ –±–æ–Ω—É—Å—É, –∞–±–æ –ø–æ–≤–Ω—ñ—Å—Ç—é –≤–∏–¥–∞–ª–∏—Ç–∏ legacy endpoint.

---

## 2. –ù–ï–í–Ü–î–ü–û–í–Ü–î–ù–û–°–¢–Ü –¢–ó

### 2.1 –†–æ–∑–±—ñ–∂–Ω–æ—Å—Ç—ñ –≤ –ª–æ–≥—ñ—Ü—ñ –ø—Ä–∏–∑—ñ–≤ –ö–æ–ª–µ—Å–∞ –§–æ—Ä—Ç—É–Ω–∏

| –ê—Å–ø–µ–∫—Ç | –¢–ó (–∫–æ–Ω—Ü–µ–ø—Ü—ñ—è) | v2 —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è | Legacy —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è |
|--------|---------------|---------------|-------------------|
| –ü—Ä–∏–∑–∏ | 5, 10, 15 –±–∞–ª—ñ–≤ | 5, 10, 15, **0** ("–°–ø—Ä–æ–±—É–π –∑–∞–≤—Ç—Ä–∞") | 5, 10, 15 |
| –†–æ–∑–ø–æ–¥—ñ–ª | –ù–µ –≤–∫–∞–∑–∞–Ω–æ | 40% / 30% / 10% / 20% | –†—ñ–≤–Ω–æ–º—ñ—Ä–Ω–∏–π (33% –∫–æ–∂–µ–Ω) |
| –ù—É–ª—å–æ–≤–∏–π –ø—Ä–∏–∑ | –ù–µ –∑–≥–∞–¥—É—î—Ç—å—Å—è –≤ –¢–ó | –Ñ (20%) | –ù–µ–º–∞—î |

**–ü—Ä–æ–±–ª–µ–º–∞:** –§—Ä–æ–Ω—Ç–µ–Ω–¥-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç `WheelOfFortune.tsx` –ø–æ–∫–∞–∑—É—î —Ç—ñ–ª—å–∫–∏ —Å–µ–≥–º–µ–Ω—Ç–∏ 5, 10, 15 (8 —Å–µ–≥–º–µ–Ω—Ç—ñ–≤) —ñ **–Ω–µ –º–∞—î —Å–µ–≥–º–µ–Ω—Ç—É "0 –±–∞–ª—ñ–≤ / –°–ø—Ä–æ–±—É–π –∑–∞–≤—Ç—Ä–∞"**. –Ø–∫—â–æ —Å–µ—Ä–≤–µ—Ä –ø–æ–≤–µ—Ä—Ç–∞—î `prize: 0`, UI –ø–æ–∫–∞–∂–µ `+0 –±–∞–ª—ñ–≤!`, —â–æ –≤–∏–≥–ª—è–¥–∞—î —è–∫ –±–∞–≥.

### 2.2 –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∏–π –±–æ–Ω—É—Å –Ω–æ–≤–∞—á–∫–æ–≤—ñ

**–¢–ó:** "+5 –±–∞–ª—ñ–≤ –Ω–æ–≤–∞—á–∫–æ–≤—ñ".
**v2 auth** (`auth.routes.ts:158`): `points: validReferrerUserId ? 5 : 0` ‚Äî –Ω–∞—Ä–∞—Ö–æ–≤—É—î +5 –ø—Ä–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ.
**–ê–ª–µ:** –ß–µ—Ä–µ–∑ –±–∞–≥ –∑ referral ID (–ø. 1.2), –≤ –±—ñ–ª—å—à–æ—Å—Ç—ñ –≤–∏–ø–∞–¥–∫—ñ–≤ `validReferrerUserId` –±—É–¥–µ `null`, —ñ –±–æ–Ω—É—Å –Ω–µ –Ω–∞—Ä–∞—Ö–æ–≤—É—î—Ç—å—Å—è.

### 2.3 –î–∏—Å—Ç–∞–Ω—Ü—ñ—è –¥–ª—è –≥–µ–æ–ø–µ—Ä–µ–≤—ñ—Ä–∫–∏

**–¢–ó:** "<100–º –≤—ñ–¥ –∫–∞–≤'—è—Ä–µ–Ω—å".
**–ö–æ–¥:** `MAX_SPIN_DISTANCE_METERS = Number(process.env.GEO_RADIUS_METERS) || 100` ‚Äî –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º 100–º, —â–æ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –¢–ó.
**–ë–æ—Ç help** (`bot/src/index.ts:518`): –≤–∫–∞–∑—É—î "–¥–æ 50–º" ‚Äî —Ä–æ–∑–±—ñ–∂–Ω—ñ—Å—Ç—å –∑ —Ä–µ–∞–ª—å–Ω–∏–º –ª—ñ–º—ñ—Ç–æ–º.

### 2.4 –ì—ñ–±—Ä–∏–¥–Ω–∞ –º–æ–¥–µ–ª—å –º–∞–≥–∞–∑–∏–Ω—É

–ú–æ–¥–µ–ª—å `Product` –ø—ñ–¥—Ç—Ä–∏–º—É—î —Ç–∏–ø–∏ `MENU`, `MERCH`, `BEANS` —á–µ—Ä–µ–∑ enum `ProductType`. –û–¥–Ω–∞–∫ —É –º–æ–¥–µ–ª—ñ `Order` —Ç–∞ `OrderItem` –Ω–µ–º–∞—î —Ä–æ–∑—Ä—ñ–∑–Ω–µ–Ω–Ω—è –ª–æ–≥—ñ–∫–∏ –∫–æ—à–∏–∫–∞ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö —Ç–∏–ø—ñ–≤ —Ç–æ–≤–∞—Ä—ñ–≤. –í—Å—ñ —Ç–æ–≤–∞—Ä–∏ –æ–±—Ä–æ–±–ª—è—é—Ç—å—Å—è –æ–¥–Ω–∞–∫–æ–≤–æ ‚Äî —Ü–µ –º–æ–∂–µ –Ω–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—Ç–∏ –≤–∏–º–æ–≥–∞–º "—Ä—ñ–∑–Ω–æ—ó –ª–æ–≥—ñ–∫–∏ –∫–æ—à–∏–∫–∞" –∑ –¢–ó.

---

## 3. –ü–†–û–ë–õ–ï–ú–ò –ë–ï–ó–ü–ï–ö–ò

### 3.1 Socket.IO –±–µ–∑ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó

**–§–∞–π–ª:** `server/src/modules/games/games.sockets.ts:42`

Socket-–∑'—î–¥–Ω–∞–Ω–Ω—è –Ω–µ –ø–µ—Ä–µ–≤—ñ—Ä—è—é—Ç—å JWT –∞–±–æ Telegram initData. –ë—É–¥—å-—Ö—Ç–æ –º–æ–∂–µ:
- –ü—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—è –¥–æ —Å–æ–∫–µ—Ç—ñ–≤
- –í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ `game:move` –∑ –¥–æ–≤—ñ–ª—å–Ω–∏–º `playerId`
- –ú–∞–Ω—ñ–ø—É–ª—é–≤–∞—Ç–∏ —Ö–æ–¥–∞–º–∏ —ñ–Ω—à–æ–≥–æ –≥—Ä–∞–≤—Ü—è

**–†—ñ—à–µ–Ω–Ω—è:** –î–æ–¥–∞—Ç–∏ middleware –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –¥–ª—è Socket.IO:
```typescript
io.use((socket, next) => {
  const token = socket.handshake.auth.token;
  const payload = verifyAccessToken(token);
  if (!payload) return next(new Error('Authentication error'));
  socket.data.userId = payload.userId;
  next();
});
```

### 3.2 Legacy Perky Jump endpoint –±–µ–∑ –∞–Ω—Ç–∏—á—ñ—Ç—É

**–§–∞–π–ª:** `server/src/modules/games/games.routes.ts:450-469`

Endpoint `/api/games/perkie-jump/save` –ø—Ä–∏–π–º–∞—î `beansCollected` –±–µ–∑:
- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Ö–µ—à—É
- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∏ —á–∞—Å—É –≥—Ä–∏
- –î–µ–Ω–Ω–æ–≥–æ –ª—ñ–º—ñ—Ç—É –±–∞–ª—ñ–≤

–ë—É–¥—å-—Ö—Ç–æ –º–æ–∂–µ –Ω–∞–¥—ñ—Å–ª–∞—Ç–∏ `{ telegramId: "...", beansCollected: 99999 }` —ñ –æ—Ç—Ä–∏–º–∞—Ç–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ñ –±–∞–ª–∏.

### 3.3 –í—ñ–¥–æ–º–∏–π salt –¥–ª—è —Ö–µ—à—É–≤–∞–Ω–Ω—è scores

**–§–∞–π–ª:** `server/src/shared/middleware/telegramAuth.ts:122`

```typescript
const salt = process.env.GAME_SCORE_SECRET_SALT ?? 'perkie-default-salt-change-me';
```

–Ø–∫—â–æ env-–∑–º—ñ–Ω–Ω–∞ –Ω–µ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è default salt, —è–∫–∏–π —î –ø—É–±–ª—ñ—á–Ω–æ –¥–æ—Å—Ç—É–ø–Ω–∏–º —É –∫–æ–¥—ñ. –¶–µ –¥–æ–∑–≤–æ–ª—è—î –∑–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –≤–∞–ª—ñ–¥–Ω–∏–π —Ö–µ—à –¥–ª—è –¥–æ–≤—ñ–ª—å–Ω–æ–≥–æ score.

### 3.4 JWT secrets –∑ –¥–µ—Ñ–æ–ª—Ç–Ω–∏–º–∏ –∑–Ω–∞—á–µ–Ω–Ω—è–º–∏

**–§–∞–π–ª:** `server/src/shared/jwt.ts:12-13`

```typescript
const JWT_SECRET = process.env.JWT_SECRET || 'perkup-dev-jwt-secret-change-in-production';
const JWT_REFRESH_SECRET = process.env.JWT_REFRESH_SECRET || 'perkup-dev-refresh-secret-change-in-production';
```

–Ø–∫—â–æ env-–∑–º—ñ–Ω–Ω—ñ –≤—ñ–¥—Å—É—Ç–Ω—ñ, —Ç–æ–∫–µ–Ω–∏ –ø—ñ–¥–ø–∏—Å—É—é—Ç—å—Å—è –ø–µ—Ä–µ–¥–±–∞—á—É–≤–∞–Ω–∏–º –∫–ª—é—á–µ–º.

### 3.5 CORS `origin: true`

**–§–∞–π–ª:** `server/src/index.ts:59`

`origin: true` –¥–æ–∑–≤–æ–ª—è—î –∑–∞–ø–∏—Ç–∏ –∑ –±—É–¥—å-—è–∫–æ–≥–æ –¥–æ–º–µ–Ω—É. –î–ª—è production-—Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ –∑ JWT-–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—î—é —Ä–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è –æ–±–º–µ–∂–∏—Ç–∏ –¥–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏—Ö –¥–æ–º–µ–Ω—ñ–≤ (`perkup.com.ua`).

### 3.6 Legacy spin endpoint –±–µ–∑ Redis lock

**–§–∞–π–ª:** `server/src/routes/users.ts:237`

Legacy `/api/user/spin` –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î Redis lock —ñ idempotency key. –¶–µ –¥–æ–∑–≤–æ–ª—è—î race condition –ø—Ä–∏ —à–≤–∏–¥–∫–∏—Ö –ø–æ–≤—Ç–æ—Ä–Ω–∏—Ö –∑–∞–ø–∏—Ç–∞—Ö ‚Äî –º–æ–∂–ª–∏–≤–µ –ø–æ–¥–≤—ñ–π–Ω–µ –Ω–∞—Ä–∞—Ö—É–≤–∞–Ω–Ω—è –±–∞–ª—ñ–≤ –∑–∞ –æ–¥–∏–Ω –¥–µ–Ω—å.

---

## 4. –ü–ï–†–ï–í–Ü–†–ö–ê –°–ü–ï–¶–ò–§–Ü–ß–ù–ò–• –í–ò–ú–û–ì

### 4.1 `ignoreTrailingSlash` —É Fastify

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ê–∫—Ç–∏–≤–æ–≤–∞–Ω–æ

```typescript
// server/src/index.ts:52
const app = Fastify({
  logger: true,
  ignoreTrailingSlash: true,
});
```

### 4.2 `seed.ts` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è —Ç–æ–≤–∞—Ä—ñ–≤

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ

- `prisma/seed.ts` ‚Äî —Ä—É—á–Ω–∏–π seed-—Å–∫—Ä–∏–ø—Ç (–æ—á–∏—â–∞—î —ñ —Å—Ç–≤–æ—Ä—é—î).
- `index.ts:105-121` ‚Äî auto-seed –ø—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ —Å–µ—Ä–≤–µ—Ä–∞ (—Ç—ñ–ª—å–∫–∏ —è–∫—â–æ —Ç–∞–±–ª–∏—Ü—ñ –ø–æ—Ä–æ–∂–Ω—ñ).
- –î–∞–Ω—ñ: `server/src/data/seedData.ts` ‚Äî 3 –ª–æ–∫–∞—Ü—ñ—ó + –ø–æ–≤–Ω–∏–π –∫–∞—Ç–∞–ª–æ–≥ –ø—Ä–æ–¥—É–∫—Ç—ñ–≤.

### 4.3 –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è 4-–∑–Ω–∞—á–Ω–æ–≥–æ –∫–æ–¥—É –∑ –≤–∞–ª—ñ–¥–∞—Ü—ñ—î—é 15 —Ö–≤

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ –≤ v2, ‚ö†Ô∏è –Ω–µ—Å—É–º—ñ—Å–Ω–æ –≤ legacy

- **V2** (`loyalty.service.ts:352`): `Math.floor(1000 + Math.random() * 9000)` ‚Üí 4 —Ü–∏—Ñ—Ä–∏. Expiry = 15 —Ö–≤. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —É–Ω—ñ–∫–∞–ª—å–Ω–æ—Å—Ç—ñ —á–µ—Ä–µ–∑ Redis. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∫–æ–¥—É –ø–µ—Ä–µ–¥ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—î—é –Ω–æ–≤–æ–≥–æ.
- **Legacy** (`routes/users.ts:451`): —Ñ–æ—Ä–º–∞—Ç `XX-00000` ‚Äî –Ω–µ—Å—É–º—ñ—Å–Ω–∏–π –∑ admin-–≤–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—î—é (–¥–∏–≤. –ø. 1.3).

### 4.4 –°–∫–∏–¥–∞–Ω–Ω—è —Å–ø—ñ–Ω—É –æ 00:00 –∑–∞ –ö–∏—î–≤–æ–º

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ö–æ—Ä–µ–∫—Ç–Ω–æ —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ

- `shared/utils/timezone.ts` –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î `Intl.DateTimeFormat` –∑ `timeZone: 'Europe/Kyiv'`.
- `lastSpinDate` –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è —è–∫ `String` —É —Ñ–æ—Ä–º–∞—Ç—ñ `YYYY-MM-DD` (–∑–∞ –ö–∏—ó–≤—Å—å–∫–∏–º —á–∞—Å–æ–º).
- `hasSpunTodayKyiv()` –ø–æ—Ä—ñ–≤–Ω—é—î –¥–∞—Ç—É-—Ä—è–¥–æ–∫ –∑—ñ —Å—å–æ–≥–æ–¥–Ω—ñ—à–Ω—å–æ—é –¥–∞—Ç–æ—é –∑–∞ –ö–∏—î–≤–æ–º.
- `getNextKyivMidnight()` –∫–æ—Ä–µ–∫—Ç–Ω–æ –æ–±—á–∏—Å–ª—é—î UTC-—á–∞—Å –Ω–∞—Å—Ç—É–ø–Ω–æ—ó –ø—ñ–≤–Ω–æ—á—ñ –∑–∞ –ö–∏—î–≤–æ–º, –≤—Ä–∞—Ö–æ–≤—É—é—á–∏ DST –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —á–µ—Ä–µ–∑ `Intl` API.
- **–ó–∞—É–≤–∞–∂–µ–Ω–Ω—è:** –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è `String` –¥–ª—è `lastSpinDate` –∑–∞–º—ñ—Å—Ç—å `DateTime` ‚Äî –Ω–∞–≤–º–∏—Å–Ω–µ —Ä—ñ—à–µ–Ω–Ω—è –¥–ª—è —É–Ω–∏–∫–Ω–µ–Ω–Ω—è timezone-–ø—Ä–æ–±–ª–µ–º –ø—Ä–∏ –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—ñ. –ü—Ä–∞—Ü—é—î –∫–æ—Ä–µ–∫—Ç–Ω–æ.

---

## 5. SOCKET.IO (TIC-TAC-TOE)

### 5.1 –°—Ç–∞–±—ñ–ª—å–Ω—ñ—Å—Ç—å –∫—ñ–º–Ω–∞—Ç

–ë–∞–∑–æ–≤–∞ –ª–æ–≥—ñ–∫–∞ –∫—ñ–º–Ω–∞—Ç –ø—Ä–∞—Ü—é—î:
- `game:join` ‚Üí `socket.join(`game:${gameId}`)` ‚úÖ
- `game:move` ‚Üí –≤–∞–ª—ñ–¥–∞—Ü—ñ—è —Ö–æ–¥—É ‚Üí broadcast `game:update` ‚úÖ
- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —á–µ—Ä–≥–æ–≤–æ—Å—Ç—ñ —Ö–æ–¥—ñ–≤ ‚úÖ
- –ù–∞—Ä–∞—Ö—É–≤–∞–Ω–Ω—è –±–∞–ª—ñ–≤ –∑–∞ –ø–µ—Ä–µ–º–æ–≥—É (max 10/–¥–µ–Ω—å) ‚úÖ

### 5.2 –©–æ —Å—Ç–∞–Ω–µ—Ç—å—Å—è –ø—Ä–∏ –≤—ñ–¥'—î–¥–Ω–∞–Ω–Ω—ñ –≥—Ä–∞–≤—Ü—è (–ü–†–û–ë–õ–ï–ú–ê)

**–§–∞–π–ª:** `server/src/modules/games/games.sockets.ts:188-190`

```typescript
socket.on('disconnect', () => {
  console.log(`[Socket.IO] Client disconnected: ${socket.id}`);
});
```

**–ü—Ä–∏ –≤—ñ–¥'—î–¥–Ω–∞–Ω–Ω—ñ:**
- –ì—Ä–∞ –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è –≤ —Å—Ç–∞—Ç—É—Å—ñ `PLAYING` –Ω–∞–∑–∞–≤–∂–¥–∏
- –Ü–Ω—à–∏–π –≥—Ä–∞–≤–µ—Ü—å –Ω–µ –æ—Ç—Ä–∏–º—É—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
- –ù–µ–º–∞—î —Ç–∞–π–º–∞—É—Ç—É –¥–ª—è –ø–æ–∫–∏–Ω—É—Ç–∏—Ö —ñ–≥–æ—Ä
- –ù–µ–º–∞—î –º–µ—Ö–∞–Ω—ñ–∑–º—É –ø–µ—Ä–µ–≤–µ–¥–µ–Ω–Ω—è –≥—Ä–∏ –≤ `ABANDONED`
- –ù–µ–º–∞—î –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ—ó –ø–µ—Ä–µ–º–æ–≥–∏ –¥–ª—è –≥—Ä–∞–≤—Ü—è, —â–æ –∑–∞–ª–∏—à–∏–≤—Å—è

**–†—ñ—à–µ–Ω–Ω—è:**
1. –ó–±–µ—Ä—ñ–≥–∞—Ç–∏ –º–∞–ø–ø—ñ–Ω–≥ `socketId ‚Üí gameId, playerId`.
2. –ü—Ä–∏ `disconnect` ‚Äî –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ —Ç–∞–π–º–µ—Ä (30 —Å–µ–∫). –Ø–∫—â–æ –≥—Ä–∞–≤–µ—Ü—å –Ω–µ –ø–µ—Ä–µ–ø—ñ–¥–∫–ª—é—á–∏—Ç—å—Å—è, –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ –≥—Ä—É –≤ `ABANDONED` –∞–±–æ –∑–∞—Ä–∞—Ö—É–≤–∞—Ç–∏ –ø–µ—Ä–µ–º–æ–≥—É –æ–ø–æ–Ω–µ–Ω—Ç—É.
3. –ü–æ–≤—ñ–¥–æ–º–∏—Ç–∏ —ñ–Ω—à–æ–≥–æ –≥—Ä–∞–≤—Ü—è —á–µ—Ä–µ–∑ `game:opponent_disconnected`.

---

## 6. –ü–û–†–ê–î–ò –©–û–î–û –û–ü–¢–ò–ú–Ü–ó–ê–¶–Ü–á

### 6.1 –í–∏–¥–∞–ª–∏—Ç–∏ legacy endpoints

Legacy-–º–∞—Ä—à—Ä—É—Ç–∏ (`/api/user/spin`, `/api/user/redeem`, `/api/user/sync`) –¥—É–±–ª—é—é—Ç—å v2-—Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å –∑ –≥—ñ—Ä—à–æ—é –±–µ–∑–ø–µ–∫–æ—é —Ç–∞ —ñ–Ω—à–æ—é –ª–æ–≥—ñ–∫–æ—é. –í–æ–Ω–∏ —Å—Ç–≤–æ—Ä—é—é—Ç—å –ø–æ–≤–µ—Ä—Ö–Ω—é –∞—Ç–∞–∫–∏ —ñ —Ä–∏–∑–∏–∫ –Ω–µ–≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ—ó –ø–æ–≤–µ–¥—ñ–Ω–∫–∏. –†–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è:
1. –ü–µ—Ä–µ–≤–µ—Å—Ç–∏ –≤—Å—ñ—Ö –∫–ª—ñ—î–Ω—Ç—ñ–≤ –Ω–∞ v2 endpoints.
2. –í–∏–¥–∞–ª–∏—Ç–∏ `server/src/routes/users.ts` –ø–æ–≤–Ω—ñ—Å—Ç—é.
3. –û–Ω–æ–≤–∏—Ç–∏ –±–æ—Ç (`bot/src/index.ts`) –¥–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è v2 API (JWT auth –∑–∞–º—ñ—Å—Ç—å telegramId —É —Ç—ñ–ª—ñ).

### 6.2 –¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π–Ω–∞ —Ü—ñ–ª—ñ—Å–Ω—ñ—Å—Ç—å —Å–ø—ñ–Ω—É

V2 spin (`loyalty.service.ts:209-261`) –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î `prisma.$transaction` ‚Äî —Ü–µ –¥–æ–±—Ä–µ. –ê–ª–µ Redis lock (–∫—Ä–æ–∫ 2) —ñ idempotency cache (–∫—Ä–æ–∫ 7) –Ω–µ —î —á–∞—Å—Ç–∏–Ω–æ—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó. –Ø–∫—â–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è –≤–ø–∞–¥–µ –ø—ñ—Å–ª—è –∫—Ä–æ–∫—É 5 (–≤–∏–±—ñ—Ä –ø—Ä–∏–∑–∞) –∞–ª–µ –¥–æ –∫—Ä–æ–∫—É 6 (–∑–∞–ø–∏—Å —É –ë–î), lock –±—É–¥–µ –≤—ñ–¥–ø—É—â–µ–Ω–∏–π —É `finally`, –∞ idempotency cache –Ω–µ –±—É–¥–µ —Å—Ç–≤–æ—Ä–µ–Ω–∏–π ‚Äî —Ç–æ–±—Ç–æ –ø–æ–≤—Ç–æ—Ä–Ω–∏–π –∑–∞–ø–∏—Ç —Å–ø—Ä–∞—Ü—é—î. –¶–µ –ø—Ä–∏–π–Ω—è—Ç–Ω–∞ –ø–æ–≤–µ–¥—ñ–Ω–∫–∞ (retry-safe).

### 6.3 Startup –ø–æ—Ä—è–¥–æ–∫

**–§–∞–π–ª:** `server/src/index.ts:146-150`

```typescript
await app.listen({ port: ... });
// Post-start tasks run in background
connectRedis().catch(...);
```

Redis –ø—ñ–¥–∫–ª—é—á–∞—î—Ç—å—Å—è **–ø—ñ—Å–ª—è** —Å—Ç–∞—Ä—Ç—É —Å–µ—Ä–≤–µ—Ä–∞. –ü–µ—Ä—à—ñ –∑–∞–ø–∏—Ç–∏ –º–æ–∂—É—Ç—å –ø–æ—Ç—Ä–∞–ø–∏—Ç–∏ –Ω–∞ "fallback" Redis (in-memory Map), —â–æ –æ–∑–Ω–∞—á–∞—î:
- Spin lock –Ω–µ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏–º–µ —Ä–æ–∑–ø–æ–¥—ñ–ª–µ–Ω–æ
- Idempotency keys –Ω–µ –∑–±–µ—Ä—ñ–≥–∞—Ç–∏–º—É—Ç—å—Å—è
- Refresh tokens –º–æ–∂—É—Ç—å –±—É—Ç–∏ –≤—Ç—Ä–∞—á–µ–Ω—ñ

**–†—ñ—à–µ–Ω–Ω—è:** –ü—ñ–¥–∫–ª—é—á–∏—Ç–∏ Redis **–¥–æ** `app.listen()`.

### 6.4 –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –ë–î-–∑–∞–ø–∏—Ç—ñ–≤

–í `loyalty.service.ts:174-185` ‚Äî –ø—Ä–∏ –∫–æ–∂–Ω–æ–º—É —Å–ø—ñ–Ω—ñ —Ä–æ–±–∏—Ç—å—Å—è –∑–∞–ø–∏—Ç `prisma.location.findMany()` –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –≤—Å—ñ—Ö –ª–æ–∫–∞—Ü—ñ–π. –û—Å–∫—ñ–ª—å–∫–∏ –ª–æ–∫–∞—Ü—ñ–π –º–∞–ª–æ (3) —ñ –≤–æ–Ω–∏ —Ä—ñ–¥–∫–æ –∑–º—ñ–Ω—é—é—Ç—å—Å—è, –≤–∞—Ä—Ç–æ –∫–µ—à—É–≤–∞—Ç–∏ —ó—Ö –≤ –ø–∞–º'—è—Ç—ñ –∞–±–æ Redis –∑ TTL 5-10 —Ö–≤–∏–ª–∏–Ω.

### 6.5 –í—ñ–¥—Å—É—Ç–Ω—ñ —ñ–Ω–¥–µ–∫—Å–∏

–ú–æ–¥–µ–ª—å `SpinHistory` –Ω–µ –º–∞—î —ñ–Ω–¥–µ–∫—Å—É –Ω–∞ `userId` ‚Äî –ø—Ä–∏ –∑—Ä–æ—Å—Ç–∞–Ω–Ω—ñ —Ç–∞–±–ª–∏—Ü—ñ –∑–∞–ø–∏—Ç–∏ —ñ—Å—Ç–æ—Ä—ñ—ó –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –±—É–¥—É—Ç—å –ø–æ–≤—ñ–ª—å–Ω—ñ—à–∞—Ç–∏. –†–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è –¥–æ–¥–∞—Ç–∏ `@@index([userId])`.

–ú–æ–¥–µ–ª—å `GameSession` –Ω–µ –º–∞—î —ñ–Ω–¥–µ–∫—Å—É –Ω–∞ `player1Id` –∞–±–æ `status` ‚Äî –∑–∞–ø–∏—Ç–∏ —Ç–∏–ø—É "–∑–Ω–∞–π—Ç–∏ —Å–µ—Å—ñ—ó –≥—Ä–∞–≤—Ü—è" –∞–±–æ "–∑–Ω–∞–π—Ç–∏ —Å–µ—Å—ñ—ó –∑—ñ —Å—Ç–∞—Ç—É—Å–æ–º WAITING" –±—É–¥—É—Ç—å –±–µ–∑ —ñ–Ω–¥–µ–∫—Å—ñ–≤.

### 6.6 Hardcoded Owner ID

`OWNER_TELEGRAM_ID = '7363233852'` –∑—É—Å—Ç—Ä—ñ—á–∞—î—Ç—å—Å—è –≤ 4+ —Ñ–∞–π–ª–∞—Ö:
- `server/src/index.ts:46`
- `server/src/routes/users.ts:8`
- `server/src/modules/auth/auth.routes.ts:145`
- `server/src/modules/admin/admin.routes.ts:26`
- `server/src/modules/loyalty/loyalty.service.ts:27` (DEV_TELEGRAM_IDS)

–†–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è –≤–∏–Ω–µ—Å—Ç–∏ –≤ —î–¥–∏–Ω—É –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é (`shared/config.ts`).

### 6.7 –§–∞–π–ª `api.py` —É client

**–§–∞–π–ª:** `client/src/components/api.py`

Python-—Ñ–∞–π–ª –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è —Å–µ—Ä–µ–¥ React-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤. –ô–º–æ–≤—ñ—Ä–Ω–æ, –∑–∞–ª–∏—à–µ–Ω–∏–π –≤–∏–ø–∞–¥–∫–æ–≤–æ. –°–ª—ñ–¥ –≤–∏–¥–∞–ª–∏—Ç–∏.

---

## 7. –ü–Ü–î–°–£–ú–ö–û–í–ê –¢–ê–ë–õ–ò–¶–Ø

| # | –ü—Ä–æ–±–ª–µ–º–∞ | –°–µ—Ä–π–æ–∑–Ω—ñ—Å—Ç—å | –ö–∞—Ç–µ–≥–æ—Ä—ñ—è |
|---|---------|-------------|-----------|
| 1.1 | devMode bypass –≥–µ–æ–ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ | üî¥ CRITICAL | –ë–µ–∑–ø–µ–∫–∞ |
| 1.2 | –ù–µ–≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ—Å—Ç—å referral ID | üî¥ CRITICAL | –õ–æ–≥—ñ–∫–∞ |
| 1.3 | Legacy-–∫–æ–¥–∏ –Ω–µ—Å—É–º—ñ—Å–Ω—ñ –∑ –≤–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—î—é | üî¥ CRITICAL | –õ–æ–≥—ñ–∫–∞ |
| 1.4 | UUID-–≤–∞–ª—ñ–¥–∞—Ü—ñ—è –¥–ª—è CUID gameId | üü† HIGH | –õ–æ–≥—ñ–∫–∞ |
| 1.5 | –ü–æ–¥–≤—ñ–π–Ω–∏–π —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∏–π –±–æ–Ω—É—Å | üü† HIGH | –õ–æ–≥—ñ–∫–∞ |
| 3.1 | Socket.IO –±–µ–∑ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó | üü† HIGH | –ë–µ–∑–ø–µ–∫–∞ |
| 3.2 | Legacy Perky Jump –±–µ–∑ –∞–Ω—Ç–∏—á—ñ—Ç—É | üü° MEDIUM | –ë–µ–∑–ø–µ–∫–∞ |
| 3.3 | Default salt –¥–ª—è score hash | üü° MEDIUM | –ë–µ–∑–ø–µ–∫–∞ |
| 3.4 | Default JWT secrets | üü° MEDIUM | –ë–µ–∑–ø–µ–∫–∞ |
| 3.5 | CORS origin: true | üü° MEDIUM | –ë–µ–∑–ø–µ–∫–∞ |
| 3.6 | Legacy spin –±–µ–∑ Redis lock | üü° MEDIUM | –°—Ç–∞–±—ñ–ª—å–Ω—ñ—Å—Ç—å |
| 5.2 | Disconnect –Ω–µ –æ–±—Ä–æ–±–ª—è—î—Ç—å—Å—è | üü° MEDIUM | –°—Ç–∞–±—ñ–ª—å–Ω—ñ—Å—Ç—å |
| 2.1 | –†–æ–∑–±—ñ–∂–Ω—ñ—Å—Ç—å –ø—Ä–∏–∑—ñ–≤ –∫–æ–ª–µ—Å–∞ | üü¢ LOW | –í—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ—Å—Ç—å –¢–ó |
| 2.3 | –†–æ–∑–±—ñ–∂–Ω—ñ—Å—Ç—å –¥–∏—Å—Ç–∞–Ω—Ü—ñ—ó (50–º vs 100–º) | üü¢ LOW | –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è |
| 6.3 | Redis –ø—ñ–¥–∫–ª—é—á–∞—î—Ç—å—Å—è –ø—ñ—Å–ª—è listen | üü¢ LOW | –°—Ç–∞–±—ñ–ª—å–Ω—ñ—Å—Ç—å |
| 6.5 | –í—ñ–¥—Å—É—Ç–Ω—ñ DB-—ñ–Ω–¥–µ–∫—Å–∏ | üü¢ LOW | –ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å |
