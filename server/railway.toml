[build]
builder = "nixpacks"
# Only compile here — postgres.railway.internal is NOT reachable during Docker build.
buildCommand = "npm install && npm run build"

[deploy]
# DB ops run at deploy time when the internal network is available.
# 'npm run start' = 'node dist/index.js' (no rebuild — already compiled above).
startCommand = "npx prisma db push --skip-generate --accept-data-loss && npx prisma db seed && npm run start"
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 3
healthcheckPath = "/health"
# healthcheckTimeout = the total retry window Railway allows before failing the deploy.
# prisma db push + db seed can take 30-60s on a cold start → use 180s as safe margin.
healthcheckTimeout = 180

[env]
NODE_ENV = "production"
